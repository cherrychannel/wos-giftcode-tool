<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ギフトコード送信テスト</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background-color: #f0f0f0;
    }
    input, button {
      padding: 0.5em;
      margin: 0.5em 0;
      font-size: 1em;
      width: 100%;
    }
    pre {
      background: #fff;
      padding: 1em;
      white-space: pre-wrap;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h1>ギフトコード送信テスト</h1>
  <label>FID（プレイヤーID）：</label>
  <input type="text" id="fid" placeholder="例: 50760935">
  <label>ギフトコード:</label>
  <input type="text" id="giftcode" placeholder="例: GW2025JP">
  <button onclick="sendGiftcode()">送信</button>
  <pre id="result"></pre>

  <script>
    const secretKey = "tB87#kPtkxqOS2";

    function generateSign(data, secret) {
      const sortedKeys = Object.keys(data).sort();
      const encoded = sortedKeys.map(key => `${key}=${data[key]}`).join("&");
      return md5(encoded + secret);
    }

    async function sendGiftcode() {
      const fid = document.getElementById("fid").value.trim();
      const giftcode = document.getElementById("giftcode").value.trim();
      const time = Math.floor(Date.now() / 1000).toString();

      const data = {
        fid: fid,
        cdk: giftcode,
        time: time,
      };

      const sign = generateSign(data, secretKey);

      const formData = new URLSearchParams();
      formData.append("fid", data.fid);
      formData.append("cdk", data.cdk);
      formData.append("time", data.time);
      formData.append("sign", sign);

      try {
        const response = await fetch("https://wos-giftcode-api.centurygame.com/api/gift_code", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          body: formData.toString()
        });

        const result = await response.json();
        document.getElementById("result").textContent = JSON.stringify(result, null, 2);
      } catch (error) {
        document.getElementById("result").textContent = "エラーが発生しました: " + error;
      }
    }
  </script>
</body>
</html>
